nav6d:
  n6d_controller:
    ros__parameters:
      # Topic wiring
      path_topic: /nav6d/planner/path          # nav_msgs/Path to track
      pose_topic: /space_cobot/pose            # geometry_msgs/PoseStamped pose estimate
      imu_topic: /imu/data                     # sensor_msgs/Imu angular velocity
      cmd_force_topic: /space_cobot/cmd_force  # geometry_msgs/Wrench output
      command_frame: body                      # body frame used by cmd_bridge
      use_goal_orientation: false              # If true, always target the final goal orientation
      debug_speed_topic: /nav6d/controller/debug/linear_speed        # std_msgs/Float32 scalar speed estimate
      debug_projected_pose_topic: /nav6d/controller/debug/path_projection  # Pose on path the robot projects onto
      debug_target_pose_topic: /nav6d/controller/debug/carrot_pose   # Lookahead pose the controller tracks
      debug_error_topic: /nav6d/controller/debug/control_error       # Twist w/ position/orientation error

      # Control loop tuning
      control_rate_hz: 100.0                    # Timer frequency for the PD loop
      lookahead_distance: 0.7                  # "Carrot" distance along the path (m)
      path_reacquire_period: 0.10               # How often we re-project onto the path (s)
      feedforward_speed: 0.0                   # Optional constant speed along the tangent (m/s)
      approach_slowdown_distance: 1.5          # Scale lookahead/feedforward when this close to goal (m)
      velocity_ema_alpha: 0.6                  # EMA blend factor for velocity estimation
      pos_tolerance: 0.12                      # Goal position tolerance (m)
      yaw_tolerance_rad: 0.015                  # Goal yaw tolerance (rad), just using yaw for simplicity
      max_velocity_mps: 0.4                    # Maximum allowed linear speed before braking (m/s)
      velocity_brake_gain: 3.5                 # Force gain applied when braking above max velocity
      debug_enabled: true                     # Enable verbose logs and debug publishers

      # Linear (xyz) PD gains
      kp_linear: [14.8, 14.8, 14.0]               # Per-axis KP for xyz position errors
      kd_linear: [12.0, 12.0, 12.0]               # Per-axis KD for xyz velocity errors

      # Angular (rpy) PD gains
      kp_angular: [2.0, 2.0, 2.0]              # KP for roll/pitch/yaw quaternion error
      kd_angular: [1.0, 1.0, 1.0]              # KD acting on angular velocity (IMU)

      # Per-axis saturation limits
      max_force_xyz: [300.0, 300.0, 300.0]        # Force clamp (body frame) [Fx, Fy, Fz]
      max_torque_rpy: [8.0, 8.0, 8.0]          # Torque clamp (body frame) [Mx, My, Mz]
